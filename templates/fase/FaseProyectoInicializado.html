{% extends 'base.html' %}
{% load static %}

{% block content %}
    <style>
        .filterDiv {
            float: left;
            width: 100%;
            line-height: 20px;
            text-align: left;
            margin: 2px;
            display: none;
        }

        .show {
          display: block;
        }

        /* Style the buttons */
        .btnItem {
            border: none;
            outline: none;
            padding: 12px 16px;
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .btnItem:hover {
          background-color: #ddd;
        }

        .btnItem.active {
          background-color: #039be5;
          color: white;
        }
    </style>

            {% if mensaje == "Éxito! La fase se cerró correctamente." %}
                <div class="exito_mensaje" >
                  <span class="closebtn">&times;</span>
                  <strong> {{ mensaje }}</strong>
                </div>
            {% endif %}
    <div class="container"><br>
        <div style="position: relative;">
            <div style="position: absolute; left: 0; top: 0; text-align: left">
                <form action="/proyecto/proyectoVer/proyectoid={{ proyecto.id }}/">
                    <button type="submit" class="waves-effect waves-teal btn-flat">
                        Volver a la vista del proyecto
                        <i class="material-icons dark blue-text left">keyboard_return</i>
                    </button>
                </form>
            </div>
            <div style="position: absolute; right: 0; top: 0; text-align: left">
                {% if  fase.estado != "cerrada" %}
                    <form action="{%url 'faseConfinicializada' proyecto.id fase.id  %}" >
                        <a href='#' onclick='this.parentNode.submit(); return false;' style="color: black" class="hvr-icon-rotate">
                            Configurar Fase
                            <i class="material-icons black-text left hvr-icon">settings</i>
                        </a>
                    </form>
                {% endif %}
            </div>
        </div>
        <br>
        <h3 style="text-align: center">{{ fase.nombre }}</h3>
        <div style="position: relative;">
            <div style="position: absolute; left: 0; top: 0; text-align: left">
                <h5>Lista de Ítems</h5>
            </div>
            <div style="position: absolute; right: 0; top: 0; text-align: left">
                {% if  fase.estado != "cerrada" %}
                    {% if tipos %}
                        <form action="/item/itemCrear/">
                            <button type="submit" class="btn blue darken-3 right">
                                Crear nuevo ítem
                                <i class="material-icons white-text left">add_circle</i>
                            </button>
                            <input  type="hidden" value={{proyecto.id}} id="proyectoid" name="proyectoid">
                            <input  type="hidden" value={{fase.id}} id="faseid" name="faseid">
                        </form>
                    {% else %}
                        <button
                            title="La fase no cuenta con Tipos de ítems. Ve a la Configuración de Fase para agregarlos y poder crear ítems."
                            style="cursor: default"
                            class="btn btn-small #eeeeee grey lighten-3 black-text right"
                        >
                            Crear nuevo ítem
                            <i class="material-icons white-text left">add_circle</i>
                        </button><br>
                    {% endif %}
                {% endif %}
            </div>
        </div>

    </div><br><br>
    <div class="container" id="myBtnContainer">
        <button class="btnItem active" onclick="filterSelection('all')"> Todos</button>
        <button class="btnItem" onclick="filterSelection('desarrollo')">Desarrollo</button>
        <button class="btnItem" onclick="filterSelection('pendiente')"> Pendientes</button>
        <button class="btnItem" onclick="filterSelection('aprobado')"> Aprobados</button>
        <button class="btnItem" onclick="filterSelection('en revisión')">En revisión</button>
        <button class="btnItem" onclick="filterSelection('abierta')"> Línea Base abierta</button>
        <button class="btnItem" onclick="filterSelection('cerrada')"> Línea Base cerrada</button>
    </div>
    <div class="container">
        <section class="section section-expenses">
                <ul class="z-depth-1">
                    <div class="filterDiv desarrollo">
                        {% for i in items_desarrollo %}
                            <li>
                                <div class="card-panel" style= "border:1px solid #03a9f4;">
                                    <div class="row">
                                        <div class="col l4 left">
                                            <b>{{ i.nombre }}</b>
                                        </div>
                                        {% if  fase.estado != "cerrada" %}
                                            <div class="col l4 right">
                                                <a href="{%url 'itemConfigurar' i.id fase.id proyecto.id%}"
                                                   title="Ver y/o modificar datos del ítem, relacionar, reversionar."
                                                >
                                                    Gestionar Ítem
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col 1">
                                            <b>Estado:</b>
                                            {{ i.estado}}
                                        </div>
                                        <div class="col l4 left">
                                            <b>Costo en horas:</b>
                                            {{ i.costo }}h
                                        </div>
                                        <div class="col 3">
                                            <b>Tipo de ítem:</b>
                                            {{ i.tipoItem.nombreTipo}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                    <div class="filterDiv pendiente">
                        {% for i in items_pendiente %}
                            <li>
                                <div class="card-panel" style="border:2px solid #ff9800;">
                                    <div class="row">
                                        <div class="col l4 left">
                                            <b>{{ i.nombre }}</b>
                                        </div>
                                        {% if  fase.estado != "cerrada" %}
                                            <div class="col l4 right">
                                                <a href="{%url 'itemConfigurar' i.id fase.id proyecto.id%}"
                                                   title="Ver y/o modificar datos del ítem, relacionar, reversionar."
                                                >
                                                    Gestionar Ítem
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col 1">
                                            <b>Estado:</b>
                                            {{ i.estado}}
                                        </div>
                                        <div class="col l4 left">
                                            <b>Costo en horas:</b>
                                            {{ i.costo }}h
                                        </div>
                                        <div class="col 3">
                                            <b>Tipo de ítem:</b>
                                            {{ i.tipoItem.nombreTipo}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                    <div class="filterDiv aprobado">
                        {% for i in items_aprobado %}
                            <li>
                                <div class="card-panel" style="border:2px solid #1b5e20;">
                                    <div class="row">
                                        <div class="col l4 left">
                                            <b>{{ i.nombre }}</b>
                                        </div>
                                        {% if  fase.estado != "cerrada" %}
                                            <div class="col l4 right">
                                                <a href="{%url 'itemConfigurar' i.id fase.id proyecto.id%}"
                                                   title="Ver y/o modificar datos del ítem, relacionar, reversionar."
                                                >
                                                    Gestionar Ítem
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col 1">
                                            <b>Estado:</b>
                                            {{ i.estado}}
                                        </div>
                                        <div class="col l4 left">
                                            <b>Costo en horas:</b>
                                            {{ i.costo }}h
                                        </div>
                                        <div class="col 3">
                                            <b>Tipo de ítem:</b>
                                            {{ i.tipoItem.nombreTipo}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                    <div class="filterDiv abierta">
                        {% for i in items_LB_abierta %}
                            <li>
                                <div class="card-panel" style="border:2.5px solid #039be5 ;">
                                    <div class="row">
                                        <div class="col l4 left">
                                            <b>{{ i.nombre }}</b>
                                        </div>
                                        {% if  fase.estado != "cerrada" %}
                                            <div class="col l4 right">
                                                <a href="{%url 'itemConfigurar' i.id fase.id proyecto.id%}"
                                                   title="Ver y/o modificar datos del ítem, relacionar, reversionar."
                                                >
                                                    Gestionar Ítem
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col 1">
                                            <b>Estado:</b>
                                            {{ i.estado}}
                                        </div>
                                        <div class="col l4 left">
                                            <b>Costo en horas:</b>
                                            {{ i.costo }}h
                                        </div>
                                        <div class="col 3">
                                            <b>Tipo de ítem:</b>
                                            {{ i.tipoItem.nombreTipo}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                    <div class="filterDiv cerrada">
                        {% for i in items_LB_cerrada %}
                            <li>
                                <div class="card-panel" style="border:2.5px solid black ;">
                                    <div class="row">
                                        <div class="col l4 left">
                                            <b>{{ i.nombre }}</b>
                                        </div>
                                        {% if  fase.estado != "cerrada" %}
                                            <div class="col l4 right">
                                                <a href="{%url 'itemConfigurar' i.id fase.id proyecto.id%}"
                                                   title="Ver y/o modificar datos del ítem, relacionar, reversionar."
                                                >
                                                    Gestionar Ítem
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col 1">
                                            <b>Estado:</b>
                                            {{ i.estado}}
                                        </div>
                                        <div class="col l4 left">
                                            <b>Costo en horas:</b>
                                            {{ i.costo }}h
                                        </div>
                                        <div class="col 3">
                                            <b>Tipo de ítem:</b>
                                            {{ i.tipoItem.nombreTipo}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                </ul>
        </section>
    </div>

    <script>
        filterSelection("all")
        function filterSelection(c) {
          var x, i;
          x = document.getElementsByClassName("filterDiv");
          if (c == "all") c = "";
          for (i = 0; i < x.length; i++) {
            w3RemoveClass(x[i], "show");
            if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
          }
        }

        function w3AddClass(element, name) {
          var i, arr1, arr2;
          arr1 = element.className.split(" ");
          arr2 = name.split(" ");
          for (i = 0; i < arr2.length; i++) {
            if (arr1.indexOf(arr2[i]) == -1) {element.className += " " + arr2[i];}
          }
        }

        function w3RemoveClass(element, name) {
          var i, arr1, arr2;
          arr1 = element.className.split(" ");
          arr2 = name.split(" ");
          for (i = 0; i < arr2.length; i++) {
            while (arr1.indexOf(arr2[i]) > -1) {
              arr1.splice(arr1.indexOf(arr2[i]), 1);
            }
          }
          element.className = arr1.join(" ");
        }

        // Add active class to the current button (highlight it)
        var btnContainer = document.getElementById("myBtnContainer");
        var btns = btnContainer.getElementsByClassName("btnItem");
        for (var i = 0; i < btns.length; i++) {
          btns[i].addEventListener("click", function(){
            var current = document.getElementsByClassName("active");
            current[0].className = current[0].className.replace(" active", "");
            this.className += " active";
          });
        }
        var close = document.getElementsByClassName("closebtn");
        var i;

        for (i = 0; i < close.length; i++) {
          close[i].onclick = function(){
            var div = this.parentElement;
            div.style.opacity = "0";
            setTimeout(function(){ div.style.display = "none"; }, 600);
          }
        }
    </script>
{% endblock%}