{% extends 'base.html' %}
{% load static %}

{% block content %}
    <style>
        .filterDiv {
            float: left;
            width: 100%;
            line-height: 20px;
            text-align: left;
            margin: 2px;
            display: none;
        }

        .show {
          display: block;
        }

        /* Style the buttons */
        .btnItem {
            border: none;
            outline: none;
            padding: 12px 16px;
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .btnItem:hover {
          background-color: #ddd;
        }

        .btnItem.active {
          background-color: #039be5;
          color: white;
        }
    </style>
    <form action="/home/">
            <button type="submit" class="waves-effect waves-teal btn-flat">
                    Volver a Home
                    <i class="material-icons dark blue-text left">keyboard_return</i>
            </button>
    </form>
    <div class="container" id="myBtnContainer">
        <h3 style="text-align: center">Usuarios</h3>
        <h5 style="text-align: center" class="grey-text">Panel de Configuración del Usuarios del Sistema</h5><br>
        <button class="btnItem active" onclick="filterSelection('all')"> Todos los Usuarios</button>
        <button class="btnItem" onclick="filterSelection('confirmados')">Usuarios Activos</button>
        <button class="btnItem" onclick="filterSelection('pendientes')"> Usuarios Pendientes</button>
        <button class="btnItem" onclick="filterSelection('deshabilitados')"> Usuarios Deshabilitados</button>
    </div>
    <div class="container">
        <section class="section section-expenses">
            <ul class="z-depth-1">
                <div class="filterDiv confirmados">
                    {% for c in confirmados %}
                        <li>
                            <div class="card-panel" style= "border:1px solid #03a9f4;">
                                <div class="row">
                                    <div class="col l4 left">
                                        <b>Username:</b>
                                        {{ c.username }}
                                    </div>
                                    {% if perm_unable_user %}
                                        <div class="col l4 right">
                                            <form action="/gestionUser/deshabilitar/"
                                                  method="post"
                                                  id="formDes"
                                            >
                                                <a href="#"
                                                   onClick="submitDes();"
                                                   title="Remover al usuario del sistema."
                                                   style="color: red"
                                                >
                                                    Deshabilitar Usuario
                                                    <i class="material-icons dark red-text left">delete</i>
                                                    {% csrf_token %}
                                                    <input  type="hidden" value={{c.id}} id="username" name="users"/>
                                                </a>
                                            </form>
                                        </div>
                                    {% endif %}
                                    {% if perm_unable_user %}
                                        <div class="col l4 right">
                                            <form action="/gestionUser/config/"
                                                  id="formConfig"
                                            >
                                                <a href="#"
                                                   onClick="document.getElementById('formConfig').submit();"
                                                   title="Ver datos, agregar o remover permisos"
                                                >
                                                    Gestionar Usuario
                                                    <i class="material-icons dark blue-text left">settings</i>
                                                    {% csrf_token %}
                                                    <input  type="hidden" value="{{c.id}}" id="usuario" name="usuario"/>
                                                </a>
                                            </form>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Nombre y Apellido:</b>
                                        {{c.first_name}}
                                        {{c.last_name }}
                                    </div>
                                    <div class="col 14 left">
                                        <b>Email:</b>
                                        {{c.email}}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Estado:</b>
                                        Activo.
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </div>
                <div class="filterDiv pendientes">
                    {% for p in pendientes %}
                        <li>
                            <div class="card-panel" style= "border:1px solid #ff9800;">
                                <div class="row">
                                    <div class="col l4 left">
                                        <b>Username:</b>
                                        {{ p.username }}
                                    </div>
                                    {% if perm_confirmar_user %}
                                        <div class="col l4 right">
                                            <form action="/gestionUser/conf/"
                                                  method="post"
                                                  id="formConf"
                                            >
                                                <a href="#"
                                                   onClick="submitConf();"
                                                   title="Agregar al usuario al sistema."
                                                >
                                                    Confirmar Usuario
                                                    <i class="material-icons dark blue-text left">person_add</i>
                                                    {% csrf_token %}
                                                    <input  type="hidden" value={{p.id}} id="username" name="users"/>
                                                </a>
                                            </form>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Nombre y Apellido:</b>
                                        {{p.first_name}}
                                        {{p.last_name }}
                                    </div>
                                    <div class="col 14 left">
                                        <b>Email:</b>
                                        {{p.email}}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Estado:</b>
                                        Pendiente de Aprobación.
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </div>
                <div class="filterDiv deshabilitados">
                    {% for d in deshabilitados %}
                        <li>
                            <div class="card-panel" style= "border:1px solid #ff3d00;">
                                <div class="row">
                                    <div class="col l4 left">
                                        <b>Username:</b>
                                        {{ d.username }}
                                    </div>
                                    <div class="col l4 right">
                                        {% if perm_enable_user %}
                                            <form
                                                    action="/gestionUser/habilitar/" method="post"
                                                    id="formEnable"
                                            >
                                                {% csrf_token %}
                                                <a href="#"
                                                   onClick="submitEnable();"
                                                   title="Agregar al usuario deshabilitado de vuelta al Sistema."
                                                >
                                                    Reincoporar Usuario al Sistema
                                                    <i class="material-icons dark blue-text left">security</i>
                                                    {% csrf_token %}
                                                </a>
                                                <input type="hidden" value={{d.id}} id="username" name="users">
                                            </form>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Nombre y Apellido:</b>
                                        {{d.first_name}}
                                        {{d.last_name }}
                                    </div>
                                    <div class="col 14 left">
                                        <b>Email:</b>
                                        {{d.email}}
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col 14 left">
                                        <b>Estado:</b>
                                        Deshabilitado.
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </div>
            </ul>
        </section>
    </div>

        <form action="/gestionUser/conf/">
            <br><button id ="guar" class="btn blue darken-3 left" type="submit" value="Confirmar Usuarios">
                    <i class="material-icons left">assignment_turned_in</i>CONFIRMAR USUARIOS
                </button>
        </form><br><br>
        <form action="/gestionUser/permisos/">
            <br><button id ="guar" class="btn blue darken-3 left"  type="submit" value="Permisos del Sistema">
                    <i class="material-icons left">vpn_key</i>PERMISOS DEL SISTEMA
                </button>
        </form><br><br>
        <form action="/gestionUser/ver/">
            <br><button id ="guar" class="btn blue darken-3 left" type="submit" value="Ver Usuarios">
                    <i class="material-icons left">assignment_ind</i> VER USUARIOS
                </button>
        </form><br><br>
        <form action="/gestionUser/modify/">
            <br><button id ="guar" class="btn blue darken-3 left"  type="submit" value="Modificar Usuarios">
                    <i class="material-icons left">create</i>MODIFICAR USUARIOS
                </button>
        </form><br><br>
        <form action="/gestionUser/deshabilitar/">
            <br><button id ="guar" class="btn blue darken-3 left"  type="submit" value="Deshabilitar Usuarios">
                    <i class="material-icons left">person_outline</i> DESHABILITAR USUARIOS
                </button>
        </form><br><br>
        <form action="/gestionUser/habilitar/">
            <br><button id ="guar" class="btn blue darken-3 left" type="submit" value="Deshabilitar Usuarios">
                    <i class="material-icons left">person</i> VOLVER A HABILITAR USUARIOS
                </button>
        </form><br>
    </div>
    <script>
        filterSelection("all")
        function filterSelection(c) {
          var x, i;
          x = document.getElementsByClassName("filterDiv");
          if (c == "all") c = "";
          for (i = 0; i < x.length; i++) {
            w3RemoveClass(x[i], "show");
            if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
          }
        }

        function w3AddClass(element, name) {
          var i, arr1, arr2;
          arr1 = element.className.split(" ");
          arr2 = name.split(" ");
          for (i = 0; i < arr2.length; i++) {
            if (arr1.indexOf(arr2[i]) == -1) {element.className += " " + arr2[i];}
          }
        }

        function w3RemoveClass(element, name) {
          var i, arr1, arr2;
          arr1 = element.className.split(" ");
          arr2 = name.split(" ");
          for (i = 0; i < arr2.length; i++) {
            while (arr1.indexOf(arr2[i]) > -1) {
              arr1.splice(arr1.indexOf(arr2[i]), 1);
            }
          }
          element.className = arr1.join(" ");
        }

        // Add active class to the current button (highlight it)
        var btnContainer = document.getElementById("myBtnContainer");
        var btns = btnContainer.getElementsByClassName("btnItem");
        for (var i = 0; i < btns.length; i++) {
          btns[i].addEventListener("click", function(){
            var current = document.getElementsByClassName("active");
            current[0].className = current[0].className.replace(" active", "");
            this.className += " active";
          });
        }
        var close = document.getElementsByClassName("closebtn");
        var i;

        for (i = 0; i < close.length; i++) {
          close[i].onclick = function(){
            var div = this.parentElement;
            div.style.opacity = "0";
            setTimeout(function(){ div.style.display = "none"; }, 600);
          }
        }

        function submitConf() {
            if (confirm("¿Está seguro de agregar a éste usuario al sistema?"))
              {
                document.getElementById('formConf').submit();
              }
        }
        function submitEnable() {
            if (confirm("¿Está seguro de agregar a éste usuario al sistema?"))
              {
                document.getElementById('formEnable').submit();
              }
        }
        function submitDes() {
            if (confirm("¿Está seguro Remover al usuario del Sistema?")) {
                document.getElementById('formDes').submit();
            }

        }
    </script>

{% endblock %}